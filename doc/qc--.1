.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.TH QC-- 1 "$ Date: $"
.SH NAME
qc-- \- The Quick C-- Compiler
.SH SYNOPSIS
\fBqc--\fP [\fIoption\fP | \fIfile\fP] ...  
.br
\fBqc--.opt\fP [\fIoption\fP | \fIfile\fP] ... 
.SH DESCRIPTION
.B qc--
is a compiler for the C-- language. It takes 
.I file
names as
arguments and compiles, assembles, and links the 
.I file
arguments into
an executable file (by default named \fBa.out\fP). An 
.I option
has the
form \fB-\fP\fIname\fP or \fIname\fP\fB=\fP\fIvalue\fP, hence any argument with an
equals sign is treated as an \fIoption\fP.  Any other argument \fBqc--\fP
regards as a \fIfile\fP.  
Usually
.B qc--
generates native code, but it can also generate code for
the Quick C-- interpreter qc--interp(1); see the
.B "-interp"
option
below. 
.PP
The
.B qc--
binary is bytecode; 
.BR qc--.opt , 
if available, is native code.
Use
.B qc--.opt
if you have it.
.PP
The
.B qc--
compiler is controlled by a built-in Lua interpreter that
runs a compiled-in Lua program. By modifying the state of the
compiler or modifying the Lua program, a user can customize the
compiler. In fact, any option of the form \fIname\fP\fB=\fP\fIvalue\fP updates a
variable in the Lua interpreter.  These aspects are documented in the
separate manual page qc--internals(1).
.PP
The treatment of a file depends on its suffix. The objective is to
compile each file such that in can be linked with all others into a
final executable.  If the suffix of a file is unrecognized, the file is
passed to the linker. 
.TP
.BR ".c--" " or " ".cmm"
C-- source file: compile, assemble, link.  A file
.B file.c--
is taken
as a C-- source file. Unless
.I options
specify otherwise, a C-- source
file is compiled to assembly code
.B file.s
and assembled to an object
file
.B file.o
that is linked with the object files derived from the
other
.I file
arguments.
.TP
.B .o
Object code file: link.  A file
.B file.o
is considered an object file.
.B qc--
does not touch this file but passes it to the linker such that
it is linked with the other files from the command line.  
.TP
.BR ".a" " or " ".so"
Archive file: link.  A file
.B file.a
or
.B file.so
is considered an
archive file that is passed untouched to the linker.
.TP
.B .s
Assembler source: assemble, link. A file
.B file.s
is taken as an
assembly source file. It is assembled to an object file
.B file.o
that
is linked with the other files from the command line.
.TP
.B .qs
Interpreter source: link. A
.B file.qs
is source code understood by the
qc--interp(1) interpreter. It is linked with other files into an
executable.
.TP
.B .lua
Lua source file: interpret. A file
.B file.lua
is taken as a Lua source
code file for the Lua interpreter built into the
.B qc--
compiler. Such
a file is executed by the interpreter. See qc--internals(1) for details.
.PP
If invoked with no arguments,
.B qc--
summarizes its options on the
standard error and exits with exit code 1.
.B qc--
removes intermediate files, like assembly files, unless options
specify otherwise. Linking is always the last stage, unless 
suppressed by the
.B "-stop"
option.
.SH OPTIONS
.B qc--
processes options from left to right, and then all file name
arguments from left to right. 
.TP
\fB-globals\fP
Inserts  the digital signature of the C-- global register variables
into the
.I first
C-- file compiled on this run.
Every C-- program must contain exactly one instance of this digital signature.
Therefore, the
.B "-globals"
option should be used on exactly one of the
compilation runs used to build the program.
(If the 
.B "-globals"
option is repeated, the digital signature is inserted into
.I every
file.)
.TP
.B "-stop .\fIextension\fP"
When the compiler derives a file whose name ends in \fB.\fP\fIextension\fP,
stop translating and keep the file.
For example, the
.B "-c"
and
.B "-S"
options used by some C compilers can be
rendered as
.B "-stop .o"
and
.B "-stop .s"
respectively.
.TP
.B "-keep .\fIextension\fP"
Keep all derived files whose names end in \fB.\fP\fIextension\fP.
.TP
.B "-keep all"
Keep all derived files, no matter what their names.
.TP
.B "-o \fIoutput\fP"
Name the output file \fIoutput\fP.
Depending on where the driver is told to stop, this file
may be assembly language,
object code, or the final executable generated by the loader.
If
.B "-o"
is not used, the
name of a final executable defaults to \fBa.out\fP.
.TP
\fB-L\fP\fIdir\fP
Add
.I dir
to the library search path. This option can be repeated and
is passed to the linker. 
.TP
\fB-l\fP\fIname\fP
Add library
.I name
to the list of libraries to be searched. This option
can be repeated is passed to the linker.
.TP
.B "-interp"
Emit code for the Quick C-- interpreter qc--interp(1). 
Because the interpreter does not distinguish assembly code from object
code,
the only intermediate files produced have the form \fIfile\fP\fB.qs\fP.
.TP
\fB-v\fP
Print commands as they are executed. Commands include calls to all
external programs, like the assembler or linker.
.TP
\fB-version\fP
Print version to stdout and stop with exit code \fB0\fP. This option is
incompatible with any other option.
.TP
\fB-help\fP
Summarize options to stdout and stop with exit code \fB0\fP. This option is
incompatible with any other option.
.TP
\fB-man\fP
Output this manual page to stdout stop with exit code \fB0\fP. This option
is incompatible with any other option.
.TP
\fIvar\fP\fB=\fP\fIvalue\fP
Assign the variable
.I var
in \fBqc--\fP's Lua interpreter the new value
\fIvalue\fP. Refer to qc--internals(1) for details.
.\" -e is documented in the internals page and is not for casual users
.SH ENVIRONMENT
.TP
TMP, TEMP, TMPDIR
The environment variables \fBTMP\fP, \fBTEMP\fP, and
.B TMPDIR
are checked in
this order. The first one found to define a non-empty string defines
the path to the directory where temporary files are stored. Otherwise a
platform-specific default directory is used. 
.PP
For documentation of other environment variables, see
.IR qc--internals(1) .
.SH EXIT CODE
Upon successful executions,
.B qc--
exists with exit code 0. If
.B qc--
finds an error in a source file or while processing command line
options, it exists with code 1. Internal errors in the compiler lead to an
exit code of 2.
.SH FILES
.TP
\fIfile\fP\fB.c--\fP, \fIfile\fP\fB.cmm\fP 
C-- source file.
.TP
\fIfile\fP\fB.o\fP
Object file.
.TP
\fIfile\fP\fB.s\fP
Assembly source file.
.TP
\fIfile\fP\fB.a\fP
Archive file (static library).
.TP
\fIfile\fP\fB.so\fP
Archive file (dynamic library).
.TP
\fIfile\fP\fB.qs\fP
Interpreter source file.
.TP
\fIfile\fP\fB.lua\fP
Lua script for compiler driver.
.TP
\fBqc--.lua\fP
Startup file for compiler driver.
.TP
\fBa.out\fP
Default file name for output file.
.TP
\fB/tmp\fP
Default directory for temporary files.
.SH SEE ALSO
http://www.cminusminus.org/,
http://www.lua.org/.
.br
lua(1), ld(1), as(1), qc--internals(1), qc--interp(1).
.SH BUGS
Report bugs to \fBbugs@cminusminus.org\fP. Include a
.I small
example that
allows us to reproduce the bug. The bug tracking system can be found at
.BR http://www.cminusminus.org/qc--bugs .
.SH AUTHORS
The team at
.BR http://www.cminusminus.org .
.SH VERSION
$Date$
